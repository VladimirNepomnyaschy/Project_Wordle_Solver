<!DOCTYPE html>
<!-- saved from url=(0042)http://manoavr.ddns.net/wordle_solver.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wordle</title>
  </head>
  <body>
    <div style="display: flex; flex-direction: column; align-items: center">
      <h3>Wordle solver</h3>
      <div style="display: grid; grid-template-columns: auto auto; gap: 4px">
        <label for="letters_count">Game size:</label>
        <input type="number" id="letters_count" value="5" min="2" max="20" onchange="update_fixed_letters()">
        <label for="valid_letters">Known letters:</label>
        <input type="text" id="valid_letters">
        <label for="fixed_letters">Positioned letters:</label>
        <div id="fixed_letters"><input type="text" id="fixed_letter_0" style="max-width: 1em; min-height: 1em; font-size: 2em; text-align: center;"><input type="text" id="fixed_letter_1" style="max-width: 1em; min-height: 1em; font-size: 2em; text-align: center;"><input type="text" id="fixed_letter_2" style="max-width: 1em; min-height: 1em; font-size: 2em; text-align: center;"><input type="text" id="fixed_letter_3" style="max-width: 1em; min-height: 1em; font-size: 2em; text-align: center;"><input type="text" id="fixed_letter_4" style="max-width: 1em; min-height: 1em; font-size: 2em; text-align: center;"></div>
        <label for="bad_letters">Bad letters:</label>
        <input type="text" id="bad_letters">
        <label for="dictionary">Dictionary:</label>
        <input type="file" id="dictionary">
        <label for="solutions_count">Max solutions count</label>
        <input type="number" id="solutions_count" value="30" min="10" max="1000">
        <button onclick="on_show_solutions()">Show solutions</button>
      </div>
      <div id="solution"></div>
    </div>
  

  <script>
    const FIXED_LETTER_PREFIX = 'fixed_letter_'

    function get_game_size() {
      return Number(document.getElementById('letters_count').value)
    }

    function get_letters_from_elem(elem) {
      return Array.from(new Set(elem.value.split('')))
    }

    function get_valid_letters() {
      return get_letters_from_elem(document.getElementById('valid_letters'))
    }

    function get_bad_letters() {
      return get_letters_from_elem(document.getElementById('bad_letters'))
    }

    function get_positioned_letters() {
      const game_size = get_game_size()
      let result = []
      for (let i = 0; i < game_size; ++i) {
        const input = document.getElementById(FIXED_LETTER_PREFIX + i)
        result.push(input && input.value.length > 0 ? input.value : null)
      }
      return result
    }

    function focus_positioned_letter_by_id(id) {
      const elem = document.getElementById(FIXED_LETTER_PREFIX + id)
      if (elem) {
        elem.focus()
      }
    }

    function create_single_letter_input(input_id) {
      const elem = document.createElement('input')
      elem.type = 'text'
      elem.id = FIXED_LETTER_PREFIX + input_id
      elem.style.maxWidth = '1em'
      elem.style.minHeight = '1em'
      elem.style.fontSize = '2em'
      elem.style.textAlign = 'center'
      elem.onkeyup = (e) => {
        if ((e.key === 'ArrowLeft' || e.key === 'Backspace') && input_id != 0) {
          focus_positioned_letter_by_id(input_id - 1)
        } else if (e.key === 'ArrowRight') {
          focus_positioned_letter_by_id(input_id + 1)
        }
      }
      elem.oninput = () => {
        elem.value = elem.value[elem.value.length - 1] || ''
        focus_positioned_letter_by_id(input_id + 1)
      }
      return elem
    }

    function update_fixed_letters() {
      const positioned_letters = get_positioned_letters()
      const fixed_letters = document.getElementById('fixed_letters')
      fixed_letters.innerHTML = ''

      const game_size = get_game_size()
      for (let i = 0; i < game_size; ++i) {
        const input = create_single_letter_input(i)
        if (i < positioned_letters.length && positioned_letters[i]) {
          input.value = positioned_letters[i]
        }
        fixed_letters.appendChild(input)
      }
    }

    function handle_file(file, handle_fn) {
      const reader = new FileReader()
      reader.onload = function () {
        handle_fn(this.result)
      }
      reader.readAsText(file)
    }

    async function on_show_solutions() {
      const dictionary_elem = document.getElementById('dictionary')
      const file = dictionary_elem.files[0]
      if (!file) {
        alert('Select file and try again')
        return
      }

      const letters_count = get_game_size()
      const valid_letters = get_valid_letters()
      const positioned_letters = get_positioned_letters()
      const bad_letters = get_bad_letters()

      handle_file(file, (text) => {
        const dictionary_words = text.split('\n')
        const solution = solve_wordle_problem(
          dictionary_words.map((w) => w.toLowerCase()),
          letters_count,
          valid_letters.map((ch) => ch.toLowerCase()),
          positioned_letters.map((ch) => (ch ? ch.toLowerCase() : ch)),
          bad_letters.map((ch) => ch.toLowerCase())
        )

        const solution_elem = document.getElementById('solution')
        solution_elem.innerHTML = ''
        console.log('Found ' + solution.length + ' solutions')
        const max_solutions = Number(
          document.getElementById('solutions_count').value || 30
        )
        solution.slice(0, Math.min(solution.length, 20)).map((word) => {
          solution_elem.innerHTML += word + '<br>'
        })
      })
    }

    function apply_validators(word, validators) {
      for (let i = 0; i < validators.length; ++i) {
        if (!validators[i](word)) {
          return false
        }
      }
      return true
    }

    function progress_index_generate(total, indexes_count) {
      let result = []
      const step = total / indexes_count
      for (let i = 1; i <= indexes_count; ++i) {
        result.push(step * i - 1)
      }
      return result
    }

    /**
     * @brief Get solution for wordle problem
     *
     * @param dictionary Big dictionary loaded from user. Array of words
     * @param letters_count Numerical count of letters in words
     * @param valid_letters User known letters. Array of letters
     * @param positioned_letters Positions of letters. Array of letters with possible null values
     * @param bad_letters User known bad letters. Array of letters
     *
     * @return Array of words which contains valid letters. Positioned letters must be in the same places. Words should not have bad letters.
     */
    function solve_wordle_problem(
      dictionary,
      letters_count,
      valid_letters,
      positioned_letters,
      bad_letters
    ) {
      const len_validator = (w) => w.length === letters_count
      const bad_letters_validator = (w) =>
        Array.from(w).reduce(
          (res, ch) => res && bad_letters.indexOf(ch) < 0,
          true
        )
      const valid_letters_validator = (w) =>
        valid_letters.every((ch) => w.indexOf(ch) >= 0)
      const positioned_validator = (w) =>
        positioned_letters.map((ch, i) => !ch || w[i] === ch).every(Boolean)

      const validators = [
        len_validator,
        bad_letters_validator,
        valid_letters_validator,
        positioned_validator,
      ]

      const words_count = dictionary.length
      const progressions = progress_index_generate(words_count, 10)
      return dictionary.filter((w, i) => {
        if (progressions.indexOf(i) >= 0) {
          console.log('Progress: ' + i + '/' + words_count)
        }
        return apply_validators(w, validators)
      })
    }

    update_fixed_letters()
  </script>

</body></html>